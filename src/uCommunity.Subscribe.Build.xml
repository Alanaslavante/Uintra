<?xml version="1.0" encoding="utf-8" ?>

<project name="uCommunity.Core" default="">
  <loadtasks assembly="C:\Program Files (x86)\nantcontrib-0.85\bin\NAnt.Contrib.Tasks.dll" />
  <loadtasks assembly="C:\Program Files (x86)\nant-0.85\bin\NAnt.Development.Tasks.dll" />

  <property name="Csc.Setting.Build.VisualStudioVersion" value="VS2015" />
  <property name="Csc.Setting.MSBuild.SolutionPath"
            value="${CcnetConfig.SourcesRootDirectory}\src\Compent.uCommunity.sln" />

  <include buildfile="${CcnetConfig.BuildToolsDirectory}\BuildScripts\Creuna.BuildTools.NAnt.xml" />

  <target name="Target.Build" description="">
    <property name="Csc.Setting.Simian.Path" value="" />
    <property name="Csc.Setting.SourceMonitor.Path" value="" />

	<if test="${Csc.Setting.Build.TargetEnvironment=='NuGet'}">
      <echo message="Csc.Setting.MSBuild.Configuration == NuGet" />
      <property name="Csc.Setting.MSBuild.Configuration" value="NuGet" />
    </if>
	
    <call target="Nuget.Restore" />

    <property name="Csc.Setting.NUnit.Path" value="C:\!BuildAccessories\Tools\NUnit-2.6.3\bin\nunit-console.exe" />
    <!--<property name="Csc.Setting.NUnit.AssemblyList" value="TeamDenmark.Common.ApiClient.Tests.dll" />-->

    <!-- <call target="Csc.Target.NUnit" /> -->
    <call target="Target.NuGet" />

  </target>
  
  <target name="Nuget.Restore">
    <exec program="${CcnetConfig.SourcesRootDirectory}\src\.nuget\nuget.exe" commandline="restore ${CcnetConfig.SourcesRootDirectory}\src\Compent.uCommunity.sln"/>
  </target>
  
  <target name="Target.NuGet">
    <delete verbose="true">
      <fileset>
        <include name="${Csc.Setting.Build.WorkingDirectory}\*.nupkg" />
      </fileset>
    </delete>

    <exec program="${CcnetConfig.SourcesRootDirectory}\src\.nuget\NuGet.exe" workingdir="${Csc.Setting.Build.WorkingDirectory}" verbose="true">
      <arg value="pack" />
      <arg file="${CcnetConfig.SourcesRootDirectory}\src\uCommunity.Subscribe\uCommunity.Subscribe.csproj" />
      <arg value="-Build" />
	  <arg line="-Properties Configuration=${Csc.Setting.MSBuild.Configuration}" />
      <arg line="-Verbosity detailed" />
    </exec>

    <robocopy source="${Csc.Setting.Build.WorkingDirectory}" destination="C:\inetpub\Nuget\Packages">
      <arg value="*.nupkg" />
      <arg value="/xx" />
    </robocopy>

  </target>
</project>
