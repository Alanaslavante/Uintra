@using System.Web.Mvc.Ajax
@using System.Web.Mvc.Html
@using uCommunity.Comments.App_Plugins.Comments.Models
@using uCommunity.Core.App_Plugins.Core
@using uCommunity.Core.App_Plugins.Core.Extentions
@model uCommunity.Comments.App_Plugins.Comments.Models.CommentViewModel

<div id="js-comment-view-@Model.Id" class="js-comment-view" data-id="@Model.Id">
    <div class="comments__list-author">
        <a href="#">
            <img class="comments__list-author-avatar" src="@ImageHelper.GetImageSrcOrDefaultAsBase64(Model.Photo)" />
        </a>
    </div>
    <div class="comments__list-body">
        <div class="comments__list-holder clearfix">
            <div class="comments__author-about">
                <span class="comments__author-name">@Model.CreatorFullName</span>
                <span class="comments__divider"> - </span>
                <span class="comments__author-date">@(Model.CreatedDate.ToString(IntranetConstants.Common.DefaultDateFormat))</span>
                <span class="comments__divider"> - </span>
                <span class="comments__author-time">@(Model.CreatedDate.ToString(IntranetConstants.Common.DefaultTimeFormat))</span>
            </div>
            
            @if (Model.CanDelete || Model.CanEdit)
            {
                <div class="comments__controls">
                    <ul class="comments__controls-list">
                        <li class="comments__controls-list-item">
                            @if (Model.CanEdit)
                            {
                                <a class="comments__controls-list-link js-comment-editlink">@Html.Localize("CommentsView.Edit.lbl")</a>
                            }
                        </li>
                        <li class="comments__controls-list-item">
                            @if (Model.CanDelete)
                            {
                                @Ajax.ActionLink(Html.Localize("CommentsView.Delete.lbl"), "Delete", "Comments", new { id = Model.Id },
                                    new AjaxOptions { HttpMethod = "Delete", UpdateTargetId = Model.ElementOverviewId, InsertionMode = InsertionMode.Replace, OnComplete = $"new CommentOverview('#{Model.ElementOverviewId}');" },
                                    new { @class = "js-comment-delete comments__controls-list-link", data_text = Html.Localize("Common.AreYouSure") })
                            }
                        </li>
                    </ul>
                </div>
            }
            @if (Model.ModifyDate.HasValue)
            {
                <div class="comments__modified">
                    <span class="glyphicon glyphicon-pencil"></span>
                    <div class="comments__modified-info">
                        @Html.Localize("CommentsView.ModifyDate.lbl")
                        <span class="comments__author-date">@(Model.ModifyDate.Value.ToString(IntranetConstants.Common.DefaultDateFormat))</span>
                        <span class="comments__divider"> - </span>
                        <span class="comments__author-time">@(Model.ModifyDate.Value.ToString(IntranetConstants.Common.DefaultTimeFormat))</span>
                    </div>
                </div>
            }
            @if (!Model.IsReply)
            {
                <a class="js-comment-showReplyLink comments__reply">@Html.Localize("CommentsView.Reply.lnk")</a>
            }
        </div>
        <div class="comments__list-text js-comment-description">
            @Html.Raw(Model.Text)
        </div>
        @if (Model.CanEdit)
        {
            <div class="comments__list-text js-comment-editContainer" style="display: none">
                <span class="js-comment-hideEditLink">Hide</span>
                @{Html.RenderPartial("~/App_Plugins/Comments/View/CommentsEditView.cshtml", new CommentEditModel { Id = Model.Id, Text = Model.Text, UpdateElementId = Model.ElementOverviewId });}
            </div>
        }
        
        @if (Model.Replies.Any())
        {
            <ul class="js-comment-view-replies comments__list _inner">
                @foreach (var reply in Model.Replies)
                {
                    <li class="comments__list-item clearfix">@{ Html.RenderPartial("~/App_Plugins/Comments/View/CommentsView.cshtml", reply);}</li>
                }
            </ul>
        }
        @if (!Model.IsReply)
        {
            <div class="js-comment-reply comments__list-replies" style="display: none">
                <span class="js-comment-hideReplyLink comments__hide"><i class="icon-close"></i></span>
                @{Html.RenderPartial("~/App_Plugins/Comments/View/CommentsCreateView.cshtml", new CommentCreateModel { ActivityId = Model.ActivityId, ParentId = Model.Id, UpdateElementId = Model.ElementOverviewId });}
            </div>
        }
    </div>
</div>